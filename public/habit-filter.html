<!DOCTYPE html>
<html lang="en">
<head>
Â Â <meta charset="UTF-8">
Â Â <title>Jumbo Habits â€“ View Habits</title>
Â Â <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â Â <link rel="stylesheet" href="style.css">
Â Â <script src="protect.js"></script>
Â Â <script src="navbar.js"></script>
</head>
<body>
Â Â <div class="container">
Â Â Â Â <h1>ðŸ“Š Your Habit Tracker ðŸ“Š</h1>

Â Â Â Â <form id="filter-form">
Â Â Â Â Â Â <label for="filter-date">Filter by Date</label>
Â Â Â Â Â Â <input type="date" id="filter-date" name="filter-date">

Â Â Â Â Â Â <label for="filter-habit">Filter by Habit</label>
Â Â Â Â Â Â <select name="filter-habit" id="filter-habit">
Â Â Â Â Â Â Â Â <option value="choose">Choose a Habit</option>
Â Â Â Â Â Â Â Â <option value="sleep">Sleep</option>
Â Â Â Â Â Â Â Â <option value="water">Water</option>
Â Â Â Â Â Â Â Â <option value="exercise">Exercise</option>
Â Â Â Â Â Â Â Â <option value="reading">Reading</option>
Â Â Â Â Â Â Â Â <option value="studying">Studying</option>
Â Â Â Â Â Â </select>

Â Â Â Â Â Â <div class="buttons-container">
Â Â Â Â Â Â Â Â <button type="submit">Search</button>
Â Â Â Â Â Â Â Â <button type="button" class="show-all-button" id="show-all-btn">Show All Entries</button>
Â Â Â Â Â Â </div>
Â Â Â Â </form>

Â Â Â Â <div id="habit-display" class="entry-display">

Â Â Â Â </div>
Â Â </div>

Â Â <!-- <script>
Â Â Â Â Â Â Â Â function populateDropdown(id, range, step = 1) {
Â Â Â Â Â Â Â Â Â Â const select = document.getElementById(id);
Â Â Â Â Â Â Â Â Â Â select.innerHTML = `<option value="">--</option>`;
Â Â Â Â Â Â Â Â Â Â for (let i = 0; i <= range; i += step) {
Â Â Â Â Â Â Â Â Â Â Â Â const opt = document.createElement("option");
Â Â Â Â Â Â Â Â Â Â Â Â opt.value = i;
Â Â Â Â Â Â Â Â Â Â Â Â opt.textContent = i;
Â Â Â Â Â Â Â Â Â Â Â Â select.appendChild(opt);
Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }
Â Â Â Â 
Â Â Â Â Â Â Â Â // Populate the dropdowns
Â Â Â Â Â Â Â Â populateDropdown("sleep", 12);
Â Â Â Â Â Â Â Â populateDropdown("water", 4);
Â Â Â Â Â Â Â Â populateDropdown("exercise", 120, 10);
Â Â Â Â Â Â Â Â populateDropdown("reading", 120, 10);
Â Â Â Â Â Â Â Â populateDropdown("studying", 4);
Â Â Â Â 
Â Â Â Â Â Â Â Â // Set today's date in the heading
Â Â Â Â Â Â Â Â const today = new Date();
Â Â Â Â Â Â Â Â const options = { month: 'long', day: 'numeric', year: 'numeric' };
Â Â Â Â Â Â Â Â const formattedDate = today.toLocaleDateString('en-US', options);
Â Â Â Â Â Â Â Â document.querySelector("h1").textContent = `Daily Habit Tracker â€“ ${formattedDate}`;
Â Â Â Â 
Â Â Â Â Â Â Â Â // Affirmation Popup
Â Â Â Â Â Â Â Â async function showAffirmationPopup() {
Â Â Â Â Â Â Â Â Â Â try {
Â Â Â Â Â Â Â Â Â Â Â Â const res = await fetch("https://www.affirmations.dev/");
Â Â Â Â Â Â Â Â Â Â Â Â const data = await res.json();
Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â document.getElementById("popup-text").textContent = data.affirmation;
Â Â Â Â Â Â Â Â Â Â Â Â const popup = document.getElementById("popup");
Â Â Â Â Â Â Â Â Â Â Â Â popup.style.display = "block";
Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â // Hide after 4 seconds
Â Â Â Â Â Â Â Â Â Â Â Â setTimeout(() => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â popup.style.display = "none";
Â Â Â Â Â Â Â Â Â Â Â Â Â Â window.location.href = "recap.html"; // âœ… move redirect INSIDE the setTimeout
Â Â Â Â Â Â Â Â Â Â Â Â }, 4000);
Â Â Â Â Â Â Â Â Â Â } catch (error) {
Â Â Â Â Â Â Â Â Â Â Â Â console.error("Error fetching affirmation:", error);
Â Â Â Â Â Â Â Â Â Â Â Â window.location.href = "recap.html"; // fallback redirect
Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }
Â Â Â Â 
Â Â Â Â Â Â Â Â // Handle form submission
Â Â Â Â Â Â Â Â document.getElementById("habitForm").addEventListener("submit", async function (event) {
Â Â Â Â Â Â Â Â Â Â event.preventDefault();
Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â const user = JSON.parse(localStorage.getItem("user"));
Â Â Â Â Â Â Â Â Â Â const userId = user?.userId;
Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â if (!userId) {
Â Â Â Â Â Â Â Â Â Â Â Â alert("You're not logged in.");
Â Â Â Â Â Â Â Â Â Â Â Â return;
Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â const today = new Date().toISOString().split("T")[0];
Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â const habitEntries = {
Â Â Â Â Â Â Â Â Â Â Â Â sleep: { value: document.getElementById("sleep").value, unit: "hours" },
Â Â Â Â Â Â Â Â Â Â Â Â water: { value: document.getElementById("water").value, unit: "gallons" },
Â Â Â Â Â Â Â Â Â Â Â Â exercise: { value: document.getElementById("exercise").value, unit: "minutes" },
Â Â Â Â Â Â Â Â Â Â Â Â reading: { value: document.getElementById("reading").value, unit: "minutes" },
Â Â Â Â Â Â Â Â Â Â Â Â studying: { value: document.getElementById("studying").value, unit: "hours" },
Â Â Â Â Â Â Â Â Â Â };
Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â const formData = {
Â Â Â Â Â Â Â Â Â Â Â Â userId,
Â Â Â Â Â Â Â Â Â Â Â Â date: today,
Â Â Â Â Â Â Â Â Â Â Â Â habits: []
Â Â Â Â Â Â Â Â Â Â };
Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â for (const [name, { value, unit }] of Object.entries(habitEntries)) {
Â Â Â Â Â Â Â Â Â Â Â Â if (value) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â formData.habits.push({ name, value, unit });
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â try {
Â Â Â Â Â Â Â Â Â Â Â Â const res = await fetch("/api/habits", {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â method: "POST",
Â Â Â Â Â Â Â Â Â Â Â Â Â Â headers: { "Content-Type": "application/json" },
Â Â Â Â Â Â Â Â Â Â Â Â Â Â body: JSON.stringify(formData)
Â Â Â Â Â Â Â Â Â Â Â Â });
Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â if (!res.ok) throw new Error("Failed to save habit data");
Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â // Disable the button immediately to prevent double clicking
Â Â Â Â Â Â Â Â Â Â Â Â const submitButton = document.querySelector("#habitForm button[type='submit']");
Â Â Â Â Â Â Â Â Â Â Â Â submitButton.disabled = true;
Â Â Â Â Â Â Â Â Â Â Â Â submitButton.textContent = "Saving...";
Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â await showAffirmationPopup(); // now handles redirection!
Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â } catch (err) {
Â Â Â Â Â Â Â Â Â Â Â Â console.error(err);
Â Â Â Â Â Â Â Â Â Â Â Â alert("Something went wrong while saving your habits.");
Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â });
Â Â Â Â Â Â </script> -->

Â Â <script>
Â Â Â Â const user = JSON.parse(localStorage.getItem("user"));
Â Â Â Â const userId = user?.userId;

Â Â Â Â if (!userId) {
Â Â Â Â Â Â alert("âš ï¸ You must be logged in to view your habits.");
Â Â Â Â Â Â window.location.href = "/login.html";
Â Â Â Â }

Â Â Â Â document.getElementById("show-all-btn").addEventListener("click", () => {
Â Â Â Â Â Â fetchAllHabits();
Â Â Â Â });

Â Â Â Â async function showAffirmationPopup() {
Â Â Â Â Â Â Â Â Â Â try {
Â Â Â Â Â Â Â Â Â Â Â Â const res = await fetch("https://www.affirmations.dev/");
Â Â Â Â Â Â Â Â Â Â Â Â const data = await res.json();
Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â document.getElementById("popup-text").textContent = data.affirmation;
Â Â Â Â Â Â Â Â Â Â Â Â const popup = document.getElementById("popup");
Â Â Â Â Â Â Â Â Â Â Â Â popup.style.display = "block";
Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â // Hide after 4 seconds
Â Â Â Â Â Â Â Â Â Â Â Â setTimeout(() => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â popup.style.display = "none";
Â Â Â Â Â Â Â Â Â Â Â Â Â Â window.location.href = "recap.html"; // âœ… move redirect INSIDE the setTimeout
Â Â Â Â Â Â Â Â Â Â Â Â }, 4000);
Â Â Â Â Â Â Â Â Â Â } catch (error) {
Â Â Â Â Â Â Â Â Â Â Â Â console.error("Error fetching affirmation:", error);
Â Â Â Â Â Â Â Â Â Â Â Â window.location.href = "recap.html"; // fallback redirect
Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â }

Â Â Â Â async function fetchAllHabits() {
Â Â Â Â Â Â const res = await fetch(`/api/habits?userId=${encodeURIComponent(userId)}`);
Â Â Â Â Â Â const data = await res.json();

Â Â Â Â Â Â renderHabits(data.entries);
Â Â Â Â }

Â Â Â Â // show habits
Â Â Â Â function renderHabits(entries, filterHabit = "") {
Â Â Â Â Â Â Â Â const display = document.getElementById("habit-display");
Â Â Â Â Â Â Â Â display.innerHTML = "";

Â Â Â Â Â Â Â Â if (!entries.length) {
Â Â Â Â Â Â Â Â Â Â Â Â display.innerHTML = "<p>No habit entries found.</p>";
Â Â Â Â Â Â Â Â Â Â Â Â return;
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â // show each habit entry in database
Â Â Â Â Â Â Â Â entries.forEach(({ date, habits }) => {
Â Â Â Â Â Â Â Â Â Â Â Â const matchingHabits = filterHabit
Â Â Â Â Â Â Â Â Â Â Â Â ? habits.filter(habit => habit.name.toLowerCase().includes(filterHabit.toLowerCase()))
Â Â Â Â Â Â Â Â Â Â Â Â : habits;

Â Â Â Â Â Â Â Â Â Â Â Â if (matchingHabits.length > 0) {
Â Â Â Â Â Â Â Â Â Â Â Â display.innerHTML += `
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="habit-entry">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <h3>${formatDate(date)}</h3>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <p>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ${matchingHabits.map(habit =>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â `<strong>${habit.name}</strong>: ${habit.value} ${habit.unit}<br>`
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ).join('')}
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <p>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â `;
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â });

Â Â Â Â Â Â Â Â if (display.innerHTML === "") {
Â Â Â Â Â Â Â Â Â Â Â Â display.innerHTML = `<p>No entries matched your filter.</p>`;
Â Â Â Â Â Â Â Â }
Â Â Â Â }

Â Â Â Â function formatDate(dateString) {
Â Â Â Â Â Â const [year, month, day] = dateString.split('-');
Â Â Â Â Â Â const date = new Date(year, month - 1, day);
Â Â Â Â Â Â const options = { month: 'long', day: 'numeric', year: 'numeric' };
Â Â Â Â Â Â return date.toLocaleDateString('en-US', options);
Â Â Â Â }

Â Â Â Â // handle filter
Â Â Â Â document.getElementById("filter-form").addEventListener("submit", async (e) => {
Â Â Â Â Â Â e.preventDefault();
Â Â Â Â Â Â 
Â Â Â Â Â Â const date = document.getElementById("filter-date").value;
Â Â Â Â Â Â const habitFilter = document.getElementById("filter-habit").value;

Â Â Â Â Â Â if (habitFilter === "choose") {
Â Â Â Â Â Â Â Â // only filter by date
Â Â Â Â Â Â Â Â if (date) {
Â Â Â Â Â Â Â Â Â Â const res = await fetch(`/api/habits?userId=${encodeURIComponent(userId)}&date=${encodeURIComponent(date)}`);
Â Â Â Â Â Â Â Â Â Â const data = await res.json();

Â Â Â Â Â Â Â Â Â Â if (res.ok && data.entry) {
Â Â Â Â Â Â Â Â Â Â Â Â renderHabits([{ date, habits: data.entry }]);
Â Â Â Â Â Â Â Â Â Â } else {
Â Â Â Â Â Â Â Â Â Â Â Â document.getElementById("habit-display").innerHTML = `<p>No entry found for ${formatDate(date)}.</p>`;
Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â } else {
Â Â Â Â Â Â Â Â // both date and habit filter
Â Â Â Â Â Â Â Â if (date) {
Â Â Â Â Â Â Â Â Â Â const res = await fetch(`/api/habits?userId=${encodeURIComponent(userId)}&date=${encodeURIComponent(date)}&habit=${encodeURIComponent(habitFilter)}`);
Â Â Â Â Â Â Â Â Â Â const data = await res.json();

Â Â Â Â Â Â Â Â Â Â if (res.ok && data.entry) {
Â Â Â Â Â Â Â Â Â Â Â Â renderHabits([{ date, habits: data.entry }], habitFilter);
Â Â Â Â Â Â Â Â Â Â } else {
Â Â Â Â Â Â Â Â Â Â Â Â document.getElementById("habit-display").innerHTML = `<p>No entry found for ${formatDate(date)} and habit "${habitFilter}".</p>`;
Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â } else {
Â Â Â Â Â Â Â Â Â Â const res = await fetch(`/api/habits?userId=${encodeURIComponent(userId)}`);
Â Â Â Â Â Â Â Â Â Â const data = await res.json();

Â Â Â Â Â Â Â Â Â Â if (res.ok && data.entries) {
Â Â Â Â Â Â Â Â Â Â Â Â renderHabits(data.entries, habitFilter);
Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â await showAffirmationPopup(); // now handles redirection!
Â Â Â Â Â Â }

Â Â Â Â Â Â // reset filters
Â Â Â Â Â Â document.getElementById("filter-date").value = ""; 
Â Â Â Â Â Â document.getElementById("filter-habit").value = "choose";
Â Â Â Â });

Â Â Â Â // load all habits on page load
Â Â Â Â fetchAllHabits();
Â Â </script>
</body>
</html>